---
title: "owmr - An R Interface to OpenWeatherMap"
output:
  html_document:
    theme: united

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("../tmp/settings.R")
```

## Introduction

```{r introduction}
library(owmr)

owm_cities %>% head()

ls("package:owmr") %>% data.frame(obj = .)
```

## Installation

```{r installation, eval=F}
require("devtools")

devtools::install_github("crazycapivara/owmr")
```

## Usage

```{r usage}
owmr_settings(api_key)
rio <- search_city_list("Rio de Janeiro")
rio

df <- find_cities_by_geo_point(
  rio$lat,
  rio$lon,
  cnt = 9,
  units = "metric"
)$list

df %>% names()

require("leaflet")

icon_url <- "http://openweathermap.org/img/w/%s.png"

weather <- df$weather %>% do.call(rbind, .)
weather$icon <- sprintf(icon_url, weather$icon)
weather$icon %>% head(2)

datetimes <- df$dt %>% as.POSIXct(origin = "1970-01-01")

leaflet(data = df, width = "100%") %>%
  addProviderTiles("CartoDB.DarkMatter") %>%
  addMarkers(~coord.lon, ~coord.lat, popup = paste0(
    datetimes, "<br>",
    df$main.temp, " Â°C <b>AT</b> ", df$name, "</br>",
    "<b>HUMIDITY</b> ", df$main.humidity, " % </br>",
    "<i>", weather$description, "</i>"), icon = icons(weather$icon)
  )

## click on icons to get further information ##

## ... ##
```
